#include "UnitTestLDAP.h"
#include "ldap_core/VS_LDAPCoreImp_Common.h"

TEST_F(UnitTestLDAP, ConvertSID)
{
	std::vector<std::pair<std::vector<uint8_t>, std::string>> v = {
		{ {0x01, 0x05},
			"" },	// small length (less then minimum 8 bytes)
		{ { 0x01, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x15, 0x00, 0x00, 0x00, 0xa9, 0x8e, 0x55, 0x4f, 0x34, 0x3b, 0x74, 0x7a, 0xee, 0x59, 0x4c, 0x84, 0x3e, 0xc0, 0x07, 0x00 },
			"S-1-5-21-1331007145-2054437684-2219596270-507966" },
		{ { 0x01, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x15, 0x00, 0x00, 0x00, 0x13, 0x0b, 0xc0, 0x90, 0xf2, 0xdf, 0xc9, 0x38, 0x3c, 0xa9, 0xa3, 0x23, 0x6d, 0x04, 0x00, 0x00},
			"S-1-5-21-2428504851-952754162-597928252-1133" },
		{ { 0x01, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x15, 0x00, 0x00, 0x00, 0x13, 0x0b, 0xc0, 0x90, 0xf2, 0xdf, 0xc9, 0x38, 0x3c, 0xa9, 0xa3, 0x23, 0x01, 0x02, 0x00, 0x00},
			"S-1-5-21-2428504851-952754162-597928252-513"},
		{ { 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x20, 0x00, 0x00, 0x00, 0x21, 0x02, 0x00, 0x00},
			"S-1-5-32-545"}
	};
	for(auto const& p: v)
		ASSERT_STREQ(tc::ConvectSIDtoString(string_view((char*)p.first.data(), p.first.size())).c_str(), p.second.c_str());
}
